#!/usr/bin/with-contenv bashio
# rootfs/etc/services.d/avahi/run
# Run Avahi daemon with proper notification for s6

set -e

bashio::log.info "Starting Avahi daemon..."

# Ensure Avahi config directory exists
mkdir -p /var/run/avahi-daemon

# Start Avahi with s6 notification on successful socket creation
exec s6-notifyoncheck -d -n 300 -w 1000 \
    -c "test -e /var/run/avahi-daemon/socket" \
    avahi-daemon --no-drop-root --no-chroot --no-daemon
